---
title: "ED Assignment"
format: pdf
editor: visual
author: Malik Jamie (JMXMAL003) and Amara Patel (PTLAMA005)
date: 21/10/2025
---

# Introduction

The aim of this experiment is to examine the effects of different intensities of heat and light on the growth of chilli plants. The goal is to determine whether light and heat affect chilli growth, which settings produce the highest quality chillies and by how much. Furthermore, whether these settings depend on variety as well as whether quality depends on variety will be explored. This is to make recommendations about which heat and light settings are optimal for small-scale farmers to implement, taking into account the cost of additional heat and light.

These goals will be tackled through an analysis of variance of this exploratory experiment.

## Design and Randomisation

### Design 
The experiment takes place over 2 seasons, season 1 and season 2. There are two greenhouses available, greenhouse A and greenhouse B, with 8 north-facing and 8 south-facing plots each. The 32 experimental units were first blocked by the random factors, season and greenhouse, to give four blocks of 16 experimental units each. The treatment factors are side (north, south) and variety (Redhot, Furious), each with two levels which results in a $2^2$ factorial treatment structure with 4 treatments, (n,F), (s,F), (n,R), (s,R). Four 4x4 latin square designs were set up with the four levels of light (1, 2, 3, 4) as a row block and the four levels of heat (1, 2, 3, 4) and to conduct randomisation, a random latin square permutation of the four treatments with each appearing once in every row and column was found for each season-greenhouse combination. 

The a-priori hypotheses that are of interest are: 

1: Does light have an effect on quality?
$$H_0: \alpha_{i} = 0 \ ,i = 1, 2, 3, 4 \\
H_1: at~least~one~\alpha_{i} \ne 0 \ , i = 1, 2, 3, 4$$

2: Does heat have an effect on quality? 
$$H_0: \beta_{j} = 0 \ ,j = 1, 2, 3, 4 \\
H_1: at~least~one~\beta_{j} \ne 0 \ , j = 1, 2, 3, 4$$

3: Does the effect of light depend on the level of heat? 
$$H_0: (\alpha\beta)_{ij} = 0 \ ,i,j = 1, 2, 3, 4 \\
H_1: at~least~one~(\alpha\beta)_{ij} \ne 0 \ , i,j = 1, 2, 3, 4$$

4: Does the effect of light and heat depend on variety?
$$H_0: (\alpha\beta\gamma)_{ijk} = (\alpha\gamma)_{ik} = (\beta\gamma)_{jk} = 0 \ ,i,j = 1, 2, 3, 4 \ , k = R, F\\
H_1: at~least~one~(\alpha\beta\gamma)_{ijk} \ne 0 \ , i,j = 1, 2, 3, 4$$

```{r Design and Randomisation}
library(dplyr)
library(knitr)
library(tibble)
library(agricolae)
library(tidyr)
library(EDproject)
library(ggplot2)

# model: essentially, side and variety are treated as treatment factors w 2 levels each, resulting in 4 combinations in a factorial experiment. light and heat are treated as blocking factors within each greenhouse-season block. 4, 4x4 lsds are created with rows corresponding to light levels and columns corresponding to heat levels and the four side-variety treatments are assigned in a standard 4x4 lsd. the model ends up being Y = mu + heat + light + season + greenhouse + side + variety + side*variety + heat*light + variety*heat + variety*light + variety*heat*light + error term. end up with 16 replicates per treatment of side-variety

set.seed(15)

# treatments 
treatments2 <- c("n,R", "s,F", "n,F", "s,R")

# create design (again oh my god)

mydesign2 <- expand.grid(season = 1:2, greenhouse = c("A", "B") ) %>%
  
  # new lsd for each season-greenhouse block w individual seed
  mutate(
    square_id = 1:n(),
    latin_seed = 15 + square_id
  ) %>%
  rowwise() %>% 
  mutate(
    latin_square = list(
      design.lsd(treatments2, serie = 0, seed = latin_seed)$book)
  ) %>%
  ungroup() %>% 
  
  # getting latin square into separate elements to be able to put it into the data frame 
  tidyr::unnest(latin_square) %>%
  rename(
    row = row,
    column = col,
    treatment = treatments2
  ) %>%
  
  # splitting the treatments into individual factors applied to put into design
  separate(treatment, into = c("side", "variety"), sep = ",") %>%
mutate(
    light = row,    # rows correspond to light levels (1-4)
    heat = column   # columns correspond to heat levels (1-4)
  ) %>%
  
# adding plot numbers (1-32 for season 1, 2)
  group_by(season) %>%
  mutate(plot = 1:n()) %>%
  ungroup() %>%
  select(plot, season, greenhouse, side, variety, light, heat) %>%
  arrange(season, plot) 

write.csv(mydesign2, file = "design2.csv", row.names = FALSE)

```

```{r Simulating observations}

set.seed(27)  

mydesign2 <- read.csv("design2.csv")
mydesign2$light <- as.factor(mydesign2$light)
mydesign2$heat <- as.factor(mydesign2$heat)
#mydesign2
mydata2 <- get.observations(mydesign2)
mydata2

```

```{r}

model <- lm (obs ~ season + greenhouse + variety*side + light*heat*variety, data=mydata2)
#model
anova(model)

```

```{r}

library(emmeans)

#table(mydata2$light, mydata2$heat)

emmeans(model, ~ light)

emmeans(model, ~ heat)

```
