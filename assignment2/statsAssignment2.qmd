---
title: "ED Assignment"
format: pdf
editor: visual
author: Malik Jamie (JMXMAL003) and Amara Patel (PTLAMA005)
date: 21/10/2025
---

# Introduction

The aim of this experiment is to examine the effects of different intensities of heat and light on the growth of chilli plants. The goal is to determine whether light and heat affect chilli growth, which settings produce the highest quality chillies and by how much. Furthermore, whether these settings depend on variety as well as whether quality depends on variety will be explored. This is to make recommendations about which heat and light settings are optimal for small-scale farmers to implement, taking into account the cost of additional heat and light.

These goals will be tackled through an analysis of variance of this exploratory experiment.

## Design and Randomisation




```{r design 2 (what we're actually going with)}
# loading packages
library(EDproject)
library(tibble)
library(knitr)
library(dplyr)

# set seed for reproducibility 
set.seed(8)

# factors as above
light <- as.factor(c(1, 2, 3, 4))
heat <- as.factor(c(1, 2, 3, 4))
variety <- as.factor(c("R", "F"))

# a new design 
mydesign <- tibble(plot = c((1:32), (1:32)),
                   season = c(rep(1, 32), rep(2, 32)), 
                   greenhouse = c(rep("A", 16), rep("B", 16), rep("A", 16), rep("B", 16)),
                   side = c(rep("n", 8), rep("s", 8), rep("n", 8), rep("s", 8), rep("n", 8), rep("s", 8), rep("n", 8), rep("s", 8))
)

# getting all treatments 
treatments <- expand.grid(variety = variety, light = light, heat = heat)

# randomly assigning within season block 
mydesign <- mydesign %>% 
  group_by(season) %>% 
  mutate(
    temp_id2 = 1:32, 
    treatment = sample(1:32)
  ) %>%
  ungroup() %>%
  mutate(variety = treatments$variety[treatment],
         light = treatments$light[treatment],
         heat = treatments$heat[treatment]) %>%
  select(-temp_id2, -treatment)

# to save as .csv file
write.csv(mydesign, file = "design.csv", row.names = FALSE)
  
```


```{r Design and Randomisation}
library(dplyr)
library(knitr)
library(tibble)
library(agricolae)
library(tidyr)
library(EDproject)
library(ggplot2)

# model: essentially, side and variety are treated as treatment factors w 2 levels each, resulting in 4 combinations in a factorial experiment. light and heat are treated as blocking factors within each greenhouse-season block. 4, 4x4 lsds are created with rows corresponding to light levels and columns corresponding to heat levels and the four side-variety treatments are assigned in a standard 4x4 lsd. the model ends up being Y = mu + heat + light + season + greenhouse + side + variety + side*variety + heat*light + variety*heat + variety*light + variety*heat*light + error term. end up with 16 replicates per treatment of side-variety

set.seed(15)

# treatments 
treatments2 <- c("n,R", "s,F", "n,F", "s,R")

# create design (again oh my god)

mydesign2 <- expand.grid(season = 1:2, greenhouse = c("A", "B") ) %>%
  
  # new lsd for each season-greenhouse block w individual seed
  mutate(
    square_id = 1:n(),
    latin_seed = 15 + square_id
  ) %>%
  rowwise() %>% 
  mutate(
    latin_square = list(
      design.lsd(treatments2, serie = 0, seed = latin_seed)$book)
  ) %>%
  ungroup() %>% 
  
  # getting latin square into separate elements to be able to put it into the data frame 
  tidyr::unnest(latin_square) %>%
  rename(
    row = row,
    column = col,
    treatment = treatments2
  ) %>%
  
  # splitting the treatments into individual factors applied to put into design
  separate(treatment, into = c("side", "variety"), sep = ",") %>%
mutate(
    light = row,    # rows correspond to light levels (1-4)
    heat = column   # columns correspond to heat levels (1-4)
  ) %>%
  
# adding plot numbers (1-32 for season 1, 2)
  group_by(season) %>%
  mutate(plot = 1:n()) %>%
  ungroup() %>%
  select(plot, season, greenhouse, side, variety, light, heat) %>%
  arrange(season, plot) 

write.csv(mydesign2, file = "design2.csv", row.names = FALSE)

```

```{r}

mydesign <- read.csv("design.csv")
mydata <- get.observations(mydesign)

mydesign2 <- read.csv("design2.csv")
mydata2 <- get.observations(mydesign2)

mydata$light <- factor(mydata$light,
                       levels = c("1", "2", "3", "4"))
#mydata$light
mydata$heat <- factor(mydata$heat,
                       levels = c("1", "2", "3", "4"))
#mydata$heat

#if we do this model, we end up with tons of interaction terms (32 different combos)
#model <- lm(obs ~ light + heat + variety + light*heat  +  light*variety + heat*variety + light*heat*variety + season, data=mydata)

model <- lm(obs ~ light*heat*variety + season, data=mydata)


# this is what the anova table looks like... don't think we need to fit reduced and full models since we just use the table and the values from the table in this section of the course (then we end up w exactly the model we are aiming to fit without all the chaotic coefficients which we can just extract from the summary lm to do our contrasts and stuff since i'm pretty sure that's what we need to do)

anova(model)

# could possibly do anova for effect of variety on light:height
#reduced1 <- lm(obs ~ light*heat + variety, data=mydata)
#anova(reduced1, model)

#and again for effect of variety on quality in general
#reduced2 <- reduced <- update(model, .~. -variety, data = mydata)
#anova(reduced2, model)

```
