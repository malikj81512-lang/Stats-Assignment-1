---
title: "STA2005S Assignment 1"
author: "Malik Jamie (JMXMAL003) and Amara Patel (PTLAMA005)"
date: "10 September 2025"
format: pdf
---

\newpage

# Part One

## Section 1:

1.  Household consumption of electricity is a major stressor on the South African power grid. The aim of this statistical analysis is to determine whether there are statistically significant effects of various variables including temperature, humidity, wind, household size, appliance intensity, energy efficiency rating, whether the household has solar power, the day of the week and whether the day is a public holiday on the daily household electricity consumption. This is to hopefully draw meaningful conclusions about what the major influences on household electricity consumption are and to prompt efficient policy-making.

2.  The analytical approach this assignment will take is that of simple and multiple linear regression to determine relationships between explanatory variables and the response variable as well as various graphical analyses of the data.

3.  The nature of this analysis is primarily explanatory as the aim is to draw conclusions about which factors influence consumption, not predict future consumption based off of the effects of these variables.

## Section 2:

```{r Preliminaries}
#| include: false
if (!requireNamespace("remotes", quietly = TRUE)) {
install.packages("remotes")
}
remotes::install_github("MiguelRodo/DataTidyRodoSTA2005S")
data("data_tidy_energy_use", package = "DataTidyRodoSTA2005S")

library(dplyr)
library(ggplot2)
library(tinytex)
```

```{r Checking out the data, include = FALSE}
glimpse(data_tidy_energy_use)
```

### 1. Density plots

```{r Histogram, echo = FALSE}
#| fig-cap: "Histogram of electricity consumption with overlaid normal curve"
#| fig.top: 0 pt
#| fig.bottom: 0 pt
#| fig-align: center
#| fig-height: 5

attach(data_tidy_energy_use)
hist(consumption_kwh, freq = FALSE, main = "", xlab = "Consumption (kW)")
# Overlaying normal curve
x_fit <- seq(min(consumption_kwh), max(consumption_kwh), length = 35) 
y_fit <- dnorm(x_fit, mean = mean(consumption_kwh), sd = sd(consumption_kwh))
lines(x_fit, y_fit, col = "red3")
detach(data_tidy_energy_use)

```

```{r Histogram with solar installed, echo = FALSE}
#| fig-cap: "Histogram of electricity consumption in households with solar installed overlaid with normal curve"
#| fig.top: 0 pt
#| fig.bottom: 0 pt
#| fig-align: center
#| fig-height: 5

attach(data_tidy_energy_use)
solar <- data_tidy_energy_use$solar_installed == "Yes"
hist(consumption_kwh[solar], freq = FALSE, main = "", xlab = "Consumption (kW)")
x_fit <- seq(min(consumption_kwh[solar]), max(consumption_kwh[solar]), length = 35)
y_fit <- dnorm(x_fit, mean = mean(consumption_kwh[solar]), sd = sd(consumption_kwh[solar]))
lines(x_fit, y_fit, col = "red3")
detach(data_tidy_energy_use)

```

### 2. Pairwise plots

```{r Pairs, echo = FALSE}
#| fig.cap: "Pairwise plots of continuous variables (consumption, outside temperature, humidity, wind speed, household size and appliance index) against each other"
pairs(data_tidy_energy_use[1:6])

```

### 3. Categorical variable plots

```{r boxplots, echo = FALSE}
str(data_tidy_energy_use$holiday)
table(data_tidy_energy_use$holiday)
table(data_tidy_energy_use$energy_efficiency)

#Converting holiday into correct categorical form
data_tidy_energy_use <- data_tidy_energy_use %>%
mutate(
  holiday = factor(holiday, 
                   labels = c("No", "Yes"))
)

ggplot(data = data_tidy_energy_use, aes(x = energy_efficiency, y = consumption_kwh)) +
  geom_boxplot(fill = "pink")+
  labs(x = "Energy efficiency", y = "Consumption(kW")

ggplot(data = data_tidy_energy_use, aes(x = solar_installed, y = consumption_kwh))+
  geom_boxplot(fill = "green3")+
  labs(x = "Solar Installed", y = "Consumption(kW")

ggplot(data = data_tidy_energy_use, aes(x = day_of_week, y = consumption_kwh))+
  geom_boxplot(fill = "purple2")+
  labs(x = "Day of Week", y = "Consumption(kW")

ggplot(data = data_tidy_energy_use, aes(x = holiday, y = consumption_kwh))+
  geom_boxplot(fill = "lightblue")+
  labs(x = "Holiday", y = "Consumption(kW")

```

### 4. Categorical Relationships

```{r more graphs, echo = FALSE}
plot_data_a <- data_tidy_energy_use %>%
  count(solar_installed, energy_efficiency)
  
ggplot(plot_data_a, aes(x = solar_installed, y = n, fill = energy_efficiency))+
  geom_col()+
  labs(x = "Solar Installed", y = "Frequency", fill = "Energy efficiency")

plot_data_b <- data_tidy_energy_use %>% 
  count(day_of_week, holiday)
plot_data_b

ggplot(plot_data_b, aes(x = day_of_week, y = n, fill = holiday))+
  geom_col()+
  labs(x = "Day of Week", y = "Frequency", fill = "Holiday")+
  theme(axis.text = element_text(angle = 90))

```

### 5. Comments

```         
Observed relationships
```

## Section 3:

### 1. Model Fitting:

```{r model fitting}

attach(data_tidy_energy_use)
# consumption_kwh vs outside_temperature 

b_hat_cheat <- lm(consumption_kwh ~ outside_temperature, data = data_tidy_energy_use)
summary(b_hat_cheat)

X <- model.matrix(consumption_kwh ~ outside_temperature)

#X <- cbind(1, data_tidy_energy_use$outside_temperature)
#X[1:10]

Y <- data_tidy_energy_use$consumption_kwh

bhat_c <- solve((t(X) %*% X)) %*% t(X) %*% Y
rownames(bhat_c) <- c("Intercept (b0)", "b1")
colnames(bhat_c) <- ("Coefficient")
detach(data_tidy_energy_use)
```

```{r Calculating standard errors}
#Calculating std. errors

bhat_c
y_fitted <- X %*% bhat_c
y_resid <- Y - y_fitted

n <- length(Y)
p <- ncol(X)

sig_hat <- as.numeric(1/(n-p) * t(y_resid) %*% y_resid)
sig_hat |> signif(5)

var_bhat_c <- sig_hat * solve((t(X) %*% X))
se_bhat_c <- sqrt(diag(var_bhat_c))
se_bhat_c |> signif(3)
```

```{r Calculating test stats and p-values}
# Calculating t-values

t_vals <- bhat_c / se_bhat_c
t_vals |> signif(3)

# Calculating p-vals
df <- n-p
p_vals <- 2 * pt(-abs(t_vals), df)

results <- data.frame(
  Estimate = as.vector(bhat_c) |> signif(3),
  StdError = se_bhat_c |> signif(3),
  t_vals = as.vector(t_vals) |> signif(5),
  p_vals = as.vector(p_vals) |> signif(3)
)
results

```

### 2. Simultaneous hypothesis test

```{r Simultaneous hypothesis test}
# consumption_kw ~ energy_efficiency
# Test at 5% significance 
# H0: b_energy = 0
# H1: b_energy /= 0

Y <- data_tidy_energy_use$consumption_kwh
n <- length(Y)
k <- 4 # no. energy efficiency groups

energy_efficiency <- sample(c("Poor", "Average", "Good", "Excellent"), n, replace = TRUE)

y_bar <- mean(Y)

# Between group sum-sqrs

grp_poor <- data_tidy_energy_use$energy_efficiency == "Poor"
#grp_poor[1:10]
y_poor <- mean(Y[grp_poor])
#y_poor
n_poor <- sum(grp_poor)
ss_poor <- n_poor * (y_poor - y_bar)^2
#ss_poor

grp_ave <- data_tidy_energy_use$energy_efficiency == "Average"
y_ave <- mean(Y[grp_ave])
n_ave <- sum(grp_ave)
ss_ave <- n_ave * (y_ave - y_bar)^2
#ss_ave

grp_good <- data_tidy_energy_use$energy_efficiency == "Good"
y_good <- mean(Y[grp_good])
n_good <- sum(grp_good)
ss_good <- n_good * (y_good - y_bar)^2
#ss_good

grp_exc <- data_tidy_energy_use$energy_efficiency == "Excellent"
y_exc <- mean(Y[grp_exc])
n_exc <- sum(grp_exc)
ss_exc <- n_exc * (y_exc - y_bar)^2
#ss_exc

#n_poor + n_ave + n_good + n_exc
ss_between <- ss_poor + ss_ave + ss_good + ss_exc
ss_between |> signif(3)

```

```{r}
# Within-group sum sqrs

ss_within_poor <- sum((Y[grp_poor] - y_poor)^2)
ss_within_ave <- sum((grp_ave - y_ave)^2)
ss_within_good <- sum((Y[grp_good] - y_good)^2)
ss_within_exc <- sum((Y[grp_exc] - y_exc)^2)
ss_within <- ss_within_poor + ss_within_ave + ss_within_good + ss_within_exc
ss_within |> signif(3)
```

```{r}
# Test stat
df_b <- k-1
df_w <- n-k

f_stat <- (ss_between/df_b) / (ss_within/df_w)
f_stat |> signif(5)

p_val <- 1 - pf(f_stat, df_b, df_w)
p_val |> signif(5)

# HUGE p-val because ss_within is huge and ss_between very small + group means very close -> basically no variation explained by energy_efficiency
# DEFINITELY can't reject H0

```

## Section 4:

### 1. Fit Model

```{r}

b_hat <- lm(consumption_kwh ~ outside_temperature + humidity + wind_speed + household_size + appliance_index + energy_efficiency + solar_installed + day_of_week + holiday, data_tidy_energy_use)

summary(b_hat)

#rownames(b_hat) <- c("Outside temp.", "Humidity", "Wind speed", "Household size", "Appliance index", "Energy efficiency: Excellent", "Energy efficiency: Good", "Energy efficiency: Poor", "Solar installed: Yes", "Day of week: Monday", "Day of week: Saturday", "Day of week: Sunday", "Day of week: Tuesday", "Day of week: Thursday", "Day of week: Wednesday")


```
